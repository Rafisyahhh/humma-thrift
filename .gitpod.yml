image: gitpod/workspace-mysql

# Commands that will run on workspace start
tasks:
  - name: Setup & Build
    before: |
      sudo apt update
      sudo apt install -y software-properties-common
      sudo add-apt-repository -y ppa:ondrej/php
      sudo apt update -y
      sudo apt install -y php8.3 php8.3-sqlite3
      touch database/database.sqlite
      sudo mkdir -p --mode=0755 /usr/share/keyrings
      curl -fsSL https://pkg.cloudflare.com/cloudflare-main.gpg | sudo tee /usr/share/keyrings/cloudflare-main.gpg >/dev/null
      echo "deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/cloudflared $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/cloudflared.list
      sudo apt-get update -y && sudo apt-get install -y cloudflared
      mkdir -p /home/codespaces/.cloudflared
      echo "url: http://localhost:8000" > /home/gitpod/.cloudflared/config.yml
      echo "tunnel: c4d8b28f-f6ca-483e-9161-29f32f7f1efa" >> /home/gitpod/.cloudflared/config.yml
      echo "credentials-file: /home/gitpod/.cloudflared/c4d8b28f-f6ca-483e-9161-29f32f7f1efa.json" >> /home/gitpod/.cloudflared/config.yml
      echo '{"AccountTag":"73157285f608392c805d6876e7ecc1ef","TunnelSecret":"DSLjdHYJvbkPxMBKsTFE321t00JeA+ZuBt2JKAg/QJU=","TunnelID":"c4d8b28f-f6ca-483e-9161-29f32f7f1efa"}' > /home/gitpod/.cloudflared/c4d8b28f-f6ca-483e-9161-29f32f7f1efa.json
      composer install
      npm i concurrently -g
